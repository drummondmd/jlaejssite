<%- include('partials/header.ejs') %>

<style>
    body{
        background-color: aliceblue;
    }
</style>
<div class="row m-4"></div>

<div class="row">
    <div class="col-2 mt-2">
        <ul class="nav nav-pills nav-fill flex-column bg-light rounded">
            <li class="nav-item"><a class="nav-link" href="/admin/home">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="/admin/usuarios">Usuarios</a></li>
            <li class="nav-item"><a href="/admin/projetos" class="nav-link">Projetos</a></li>
            <li class="nav-item"><a href="/admin/orcamentos" class="nav-link">Orçamentos</a></li>
            <li class="nav-item"><a href="/logout" class="nav-link">Sair</a></li>
    </div>
    <div class="col-9 mt-2" style="background-color: beige;">
    <div class="row">
        <div class="col-6">
            <% if(locals.projeto){%>
                <p class="h3"><%=projeto.nome%></p>
                <p ><%=projeto.finalidade%>,<%=projeto.cidade%></p>
                <p ><%=projeto.endereco%></p>
                <p ><%=projeto.status%></p>

            <% }else{ %>
                <p>Algo deu errado ao renderizar projeto</p>
                <% } %>

        </div>
        <div class="col-6">
            <div class="row">
                <div class="col m-2 btn-group">
                    <button type="button" class="btn btn-outline-secondary">Etapas</button>
                    <button type="button" class="btn btn-outline-secondary">Fotos</button>
                    <button type="button" class="btn btn-outline-secondary">Documentos</button>
                </div>
            </div>
            <div class="row">
                <div class="col-12" id="fotos-projeto" style="display: none;">
                    Fotos

                </div>
                <div class="col-12" id="etapas-projeto" style="display: none;">
                    <table class="table table-striped">
                        <thead class="thead-light">
                            <tr>
                                <th>Etapa:</th>
                                <th>Dias faltantes</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if(locals.etapas){ %>
                                <% if(etapas.length == 0){ %>
                                    <tr>
                                        <td colspan="3">Nenhuma etapa registrada</td>
                                    </tr>
                                    <tr>
                                        <td colspan="3">
                                            <button id="finalizar-projeto" type="button" class="btn btn-success col-12">Finalizar Projeto</button>
                                        </td>
                                    </tr>
                                    <% }else{ %>

                                <%etapas.forEach(element => {%>
                                    <tr>
                                        <td><%=element.nome_etapa%></td>
                                        <td><%=element.dpe%></td>
                                        <td>
                                            <form action="/atualizar-etapas/<%=element.id%>" method="post">
                                                <select name="status" id="status" class="form-select" onchange="this.form.submit()">
                                                    <option value="<%= element.status %>" selected><%= element.status %></option>
                                                    <option value="Finalizado">Finalizado</option>
                                                    <option value="Em aberto">Em aberto</option>

                                                </select>

                                            </form>
                                        </td>
                                    </tr>
                                <%}); %>
                                <tr>
                                    <td colspan="3">
                                        <button id="finalizar-projeto" type="button" class="btn btn-success col-12">Finalizar Projeto</button>
                                    </td>
                                </tr>
                                <% } %>

                            <% }else{ %>

                            <tr>
                                <td colspan="4">Nenhuma etapa do projeto registrada</td>
                            </tr>

                            <% } %>

                        </tbody>
                    </table>

                </div>
                <div class="col-12" id="documentos-projeto">
                    <% if(locals.documentos){ %>
                        <% documentos.arrayDocumentos.forEach(element => { %>
                            <div class="col-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-file-word" viewBox="0 0 16 16">
                                    <path d="M4.879 4.515a.5.5 0 0 1 .606.364l1.036 4.144.997-3.655a.5.5 0 0 1 .964 0l.997 3.655 1.036-4.144a.5.5 0 0 1 .97.242l-1.5 6a.5.5 0 0 1-.967.01L8 7.402l-1.018 3.73a.5.5 0 0 1-.967-.01l-1.5-6a.5.5 0 0 1 .364-.606z"/>
                                    <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1"/>
                                  </svg>
                                <%= element.nome %>

                            </div>
                            <div class="col-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-file-word" viewBox="0 0 16 16">
                                    <path d="M4.879 4.515a.5.5 0 0 1 .606.364l1.036 4.144.997-3.655a.5.5 0 0 1 .964 0l.997 3.655 1.036-4.144a.5.5 0 0 1 .97.242l-1.5 6a.5.5 0 0 1-.967.01L8 7.402l-1.018 3.73a.5.5 0 0 1-.967-.01l-1.5-6a.5.5 0 0 1 .364-.606z"/>
                                    <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1"/>
                                  </svg>
                                <%= element.nome %>

                            </div>


                        <% }) %>


                        <% }else{ %>
                            <p>Não foi possivel acessar os documentos</p>
                                <% } %>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class= "btn-group col-12">
            <button class="btn btn-outline-secondary ">Vincular Cliente</button>
            <button class="btn btn-outline-secondary ">Adicionar arquivos</button></div>
    </div>

    <div class="row mt-4">
        <div class="col-12" id="vincular-cliente" style="display: none;">
            <div class="form-group">
                <form action="/client-add" method="post">
                    <input type="number" name="project_id" readonly value="<%= projeto.id %>" hidden>
                    <label class="form-label" for="cliente">Escolha o cliente do projeto:</label>
                    <select class="form-control" name="cliente" id="">
                        <option >Selecione usuário:</option>
                        <% if(locals.users){%>
                            <% users.forEach((elem)=>{%>
                               <option value="<%=elem.id%>"><%=elem.nome%></option>
                           <% }) %>
                        <%}else{%>
                            <option> Algo deu errado</option>
                       <% } %>
                    </select>
                    <button class="btn btn-outline-primary col-12 mt-2">Vincular</button>
                </form>

            </div>

        </div>
        <div class="col-12" id="adicionar-arquivos">Adicionar</div>


    </div>


    </div>
</div>

<div class="col">
    <div clas="section-edit" id="adicionar-link">
        <form action="/link-add" method="post">
            <input name="id" type="number" readonly value="<%=projeto.id%>" >

            <label for="type">Tipo de documento</label>
            <select name="type" id="type">
                <option selected >...</option>
                <option value="spreadsheet">Tabela</option>
                <option value="imagens">Imagens</option>
                <option value="documentos">Documentos do projeto</option>
                <option value="arquivos">Arquivos de projeto</option>
            </select>
            <label for="nomelink">Nome</label>
            <input type="text" id="nomelink" name="nomelink"required>
            <label for="link">Link</label>
            <input type="text" name="link" id="link">
            <label for="obslink">Observação</label>
            <input type="text" name="obslink" id="obslink">
            <label for="type">Tipo de documento</label>
            <select name="type" id="type">
                <option selected >...</option>
                <option value="spreadsheet">Tabela</option>
                <option value="imagens">Imagens</option>
                <option value="documentos">Documentos do projeto</option>
                <option value="arquivos">Arquivos de projeto</option>
            </select>
            <label for="nomelink">Nome</label>
            <input type="text" id="nomelink" name="nomelink"required>
            <label for="link">Link</label>
            <input type="text" name="link" id="link">
            <label for="obslink">Observação</label>
            <input type="text" name="obslink" id="obslink">
            <input type="submit" value="Enviar">
        </form>
        <button>Acrescentar outro</button>


        form para adicionar links

    </div>

</div>


<!--Div comentada de editar projeto, para se fazer depois-->
<!-- <div class="container">
    <div class="row">
        <section clas="section-edit" id="edit-form" style="display: none;">

        <div class="col">
            <div class="container">
                <form action="/editar-projeto" method="post">
                    <div class="form-group">
                        <label for="id">ID</label>
                        <input type="text" name="id" value="<%=projeto.id%>" readonly>
                    </div>
                    <div class="form-group">
                        <label for="nomedoprojeto">Nome do projeto</label>
                        <input class="form-control" type="text" name="nome" id="nomedoprojeto" value="<%=projeto.nome%>">
                    </div>
                    <div class="form-control">
                        <label for="enderecodoprojeto">Endereço:</label>
                        <input class="form-control" type="text" name="endereco" id="enderecodoprojeto" value="<%=projeto.endereco%>">
                    </div>
                    <div class="form-group">
                        <label for="orcamento">Orçamento:</label>
                        <input class="form-control" type="number" name="orcamento" id="orcamento" value="<%=projeto.orcamento%>">
                    </div>
                    <div class="form-group">
                        <label for="custoobra">Custo da obra:</label>
                        <input class="form-control" type="number" name="custo_obra" id="custoobra" value="<%=projeto.custo_obra%>">
                    </div>
                    <div class="form-group">
                        <select class="form-select" name="finalidade" id="">
                            <option value="residencial">Residencial</option>
                            <option value="comercial">Comercial</option>
                            <option value="corporativo">Corporativo</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <span>Mostrar em Homepage</span>
                        <div class="form-check">
                            <input type="radio" class="form-check-input" id="simcheckdisplay"name="display" value="true">
                            <label class="form-check-label" for="simcheckdisplay">Sim</label>
                        </div>
                        <div class="form-check">
                            <input type="radio" class="form-check-input" id="naocheckdisplay"name="display" value="false">
                            <label class="form-check-label" for="naocheckdisplay">Não</label>
                        </div>
                    </div>
                    <div class="input-group">
                        <span>Projeto Ativo</span>
                        <div class="form-check">
                            <input type="radio" class="form-check-input" id="simcheckativo" name="ativo" value="true">
                            <label class="form-check-label" for="simcheckativo">Sim</label>
                        </div>
                        <div class="form-check">
                            <input type="radio" class="form-check-input" id="naocheckativo" name="ativo" value="false">
                            <label class="form-check-label" for="naocheckativo">Não</label>
                        </div>
                    </div>
                    <div class="input-group">
                        <% if(locals.users){%>
                            <div class="form-group">
                                <select class="form-select" name="cliente" id="">
                                    <option value="">Selecionar cliente</option>
                                    <% users.forEach(element => {%>
                                        <option value="<%= element.id %>"> <%= element.nome%> <%= element.sobrenome%> </option>



                                   <% }) %>
                                    </select>

                            </div>

                       <% }else{ %>
                        <input class="form-control" type="text" name="cliente">



                        <% }%>




                    </div>
                    <input type="submit" class="btn btn-outline-primary">

                </form>



            </div>

        </div>
        </section>




    </div>

</div>-->


<%- include('partials/footer.ejs') %>

<script>

</script>